# Telegram Mini App Plan (v1)

Scope: дать пользователям открыть и бронить вишлисты внутри Telegram с минимальным трением, без ломки будущего развития.

## Потоки
- Share (веб): кнопка «Поделиться в Telegram» вызывает deeplink к боту с `start=list_<uuid>`. Бот шлёт готовое сообщение с кнопкой `Открыть вишлист` (Web App) + короткая веб-ссылка fallback.
- Share (TG): пользователь запускает `/start list_<uuid>` → получает то же сообщение, может переслать в чат/канал.
- Open (Mini App): по `start_param=list_<uuid>` валидируем `initData`, тянем публичный GET wishlist, рендерим лёгкую копию главной страницы.

## UI Mini App (легковес)
- Внешний вид: тот же стиль, что главная, но без тяжёлых зависимостей; тема из Telegram WebApp SDK.
- Структура: заголовок, описание, список карточек предметов; статусы брони.
- Действия:
  - «Забронировать»: POST `/wishlists/{id}/items/{itemId}/book` с `bookerName` (если не аноним), `message` (опционально как на веб).
  - Чекбокс «Анонимно»: при включении не отправляем имя.
  - Автоподстановка имени: берем `first_name + last_name` из Telegram, поле не редактируем.
  - «Отменить бронь»: DELETE `/unbook?cancellationToken=...`, токен храним в sessionStorage.
- Обновление: при открытии рефрешим данные (GET).

## Бот
- Обработчик `/start list_<uuid>`: формирует сообщение-превью без предметов (только название и статус свободно/занято) + кнопка Web App «Открыть вишлист» с тем же start_param + веб-ссылка в тексте.
- Валидация `initData` для WebApp запросов по bot token подписи.
- Inline-mode: не включаем в v1.

## API/бэкенд опоры (уже есть)
- Публичный GET wishlist.
- POST book: возвращает `bookingId`, `cancellationToken`, `bookerName`, `message`.
- DELETE unbook: по `cancellationToken` (гость) или `bookingId` с auth (владелец) — используем токен путь.

## Ограничения и будущее
- Ссылки с UUID публичны в v1; позже можно добавить share_token без ломки start_param (ввести версию в параметр).
- Кабинет владельца, уведомления, inline-mode, приватные списки — в v2+.

